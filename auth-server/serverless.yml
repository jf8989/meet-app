service: auth-server

frameworkVersion: "4"

provider:
  name: aws
  runtime: nodejs18.x
  region: us-east-1
  environment:
    CLIENT_ID: ${file(.env):CLIENT_ID}
    CLIENT_SECRET: ${file(.env):CLIENT_SECRET}
    PROJECT_ID: ${file(.env):PROJECT_ID}

functions:
  getAuthURL:
    handler: handler.getAuthURL
    events:
      - http:
          path: api/get-auth-url
          method: get
          cors: true

  getAccessToken:
    handler: handler.getAccessToken
    events:
      - http:
          path: api/token/{code}
          method: get
          cors: true

  getCalendarEvents:
    handler: handler.getCalendarEvents
    events:
      - http:
          path: api/get-events/{access_token}
          method: get
          cors: true

package:
  patterns:
    - "!**/*"
    - "!node_modules/**"
    - "handler.js"
    - "package.json"
    - ".env"

custom:
  build:
    esbuild:
      format: esm
      platform: node
      target: node18
      sourcemap: true
      minify: true
